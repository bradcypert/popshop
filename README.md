## popshop

![coverage][coverage_badge]
[![style: very good analysis][very_good_analysis_badge]][very_good_analysis_link]
[![License: MIT][license_badge]][license_link]

Generated by the [Very Good CLI][very_good_cli_link] ü§ñ

HTTP mocking and proxy server for API development and testing.

---

## Getting Started üöÄ

### Installation

If the CLI application is available on [pub](https://pub.dev), activate globally via:

```sh
dart pub global activate popshop
```

Or locally via:

```sh
dart pub global activate --source=path <path to this package>
```

### Development Setup

This project uses `mise` for environment management:

```sh
# Trust the mise configuration (first time only)
mise trust

# Install tools (Dart SDK)
mise install

# Install dependencies and build
mise run dev
```

## Usage

### Basic Server Commands

```sh
# Start HTTP server with YAML configuration
$ popshop serve config.yaml

# Start server on custom port
$ popshop serve config.yaml --port 3000

# Start server with file watching (auto-reload on config changes)
$ popshop serve config.yaml --watch

# Start server on specific host
$ popshop serve config.yaml --host 0.0.0.0 --port 8080

# Show CLI version
$ popshop --version

# Show usage help
$ popshop --help
```

### Configuration Format

Popshop uses YAML files to define request/response rules and proxy configurations:

```yaml
# Simple mock response
- request:
    path: "/api/health"
    verb: get
  response:
    body: '{"status": "ok"}'
    status: 200
    headers:
      content-type: "application/json"

# Proxy to external service
- request:
    path: "/api/external"
    verb: get
  proxy:
    url: https://httpbin.org/get
    headers:
      x-forwarded-by: "popshop"
```

### Features

- **Mock API Responses**: Define custom responses for specific HTTP requests
- **Proxy Forwarding**: Forward requests to external APIs with custom headers
- **File Watching**: Automatically reload configuration changes during development
- **Flexible Matching**: Match requests by path and HTTP verb
- **Custom Headers**: Set response headers and proxy headers
- **Multiple Rules**: Single YAML file can contain multiple request/response rules

### Examples

See the `examples/` directory for sample configurations:

- `examples/api.yaml` - Multiple API endpoints with different response types
- `examples/users.yaml` - User management API endpoints
- `examples/readme.yaml` - Basic health check endpoint

## Development üõ†Ô∏è

### Available Commands

```sh
# Run tests
mise run test

# Run tests with coverage
mise run test-coverage

# Analyze code
mise run analyze

# Format code
mise run format

# Apply automated fixes
mise run fix

# Build the project
mise run build
```

### Running Tests with Coverage üß™

To run all unit tests use the following command:

```sh
$ dart pub global activate coverage 1.2.0
$ dart test --coverage=coverage
$ dart pub global run coverage:format_coverage --lcov --in=coverage --out=coverage/lcov.info
```

To view the generated coverage report you can use [lcov](https://github.com/linux-test-project/lcov)
.

```sh
# Generate Coverage Report
$ genhtml coverage/lcov.info -o coverage/

# Open Coverage Report
$ open coverage/index.html
```

---

[coverage_badge]: coverage_badge.svg
[license_badge]: https://img.shields.io/badge/license-MIT-blue.svg
[license_link]: https://opensource.org/licenses/MIT
[very_good_analysis_badge]: https://img.shields.io/badge/style-very_good_analysis-B22C89.svg
[very_good_analysis_link]: https://pub.dev/packages/very_good_analysis
[very_good_cli_link]: https://github.com/VeryGoodOpenSource/very_good_cli